{% extends 'base.html' %}
{% block title %}Home｜issue-management{% endblock title %}

{% block content %}

<!-- 検索フォーム -->
<form class="mt-2" id="search-form" action="" method="GET">
  <div>
    <label class="label mr-4">年月</label>
    {{ search_form.year }}
    {{ search_form.month }}
  </div>
  <div class="mt-4">
    {{ search_form.key_word }}
    <button class="btn btn-info ml-4" type="submit">検索</button>
  </div>
  <div class="mt-2 inline">
    {{ search_form.progress }}
  </div>
</form>

<!-- メッセージを表示（トースト） -->
<div class="toast-container position-fixed top-0 end-0 p-3">
  {% if messages %}
  {% for message in messages %}
  <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true">
      <div class="toast-header">
          <strong class="me-auto">通知</strong>
          <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
          {{ message }}
      </div>
  </div>
  {% endfor %}
  {% endif %} 
</div>

{% block h1 %}課題リスト{% endblock h1 %}
<div class="table-responsive">
  <table class="table table-hover">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">件名</th>
        <th scope="col">更新日​</th>
        <th scope="col">期限日</th>
        <th scope="col">区分</th>
        <th scope="col">担当者</th>
        <th scope="col">状態</th>
        <th scope="col"></th>
      </tr>
    </thead>
    <tbody>
      {% for issues in object_list %}
      <tr class="align-middle">
        <th scope="row">{{ issues.id }}</th>
        <td>{{ issues.title }}</td>
        <td>{{ issues.date_of_update }}</td>
        <td>
          {% if now_date > issues.deadline %} 
            <span style="color: #e60012">{{ issues.deadline }}
              <!-- アイコン -->
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-exclamation-circle" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
              </svg>
            </span>
          {% else %}{{ issues.deadline }}
          {% endif %}
        </td>
        <td>{{ issues.get_type_display }}</td>
        <td>{{ issues.get_person_display }}</td>
        <td>{{ issues.get_progress_display }}</td>
        <td><a href="{% url 'detail' issues.id %}" class="btn btn-secondary">詳細</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- ページネーション -->
<div class="mt-4">
  <nav aria-label="Search results pages">
    {% load issue %}
    <ul class="pagination justify-content-center">
      <!-- 最初へ／前へ -->
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?{%  url_replace request 'page' 1 %}">First</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?{%  url_replace request 'page' page_obj.previous_page_number %}">&laquo;</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <a class="page-link">First</a>
        </li>
        <li class="page-item disabled">
          <a class="page-link">&laquo;</a>
        </li>
      {% endif %}

      <!-- ページリンク -->
      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <li class="page-item active" aria-current="page">
            <a class="page-link">{{ num }}</a>
          </li>
        {% else %}
        <li class="page-item">
          <a class="page-link" href="?{%  url_replace request 'page' num %}">{{ num }}</a>
        </li>
        {% endif %}
      {% endfor %}

      <!-- 次へ／最後へ -->
      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?{%  url_replace request 'page' page_obj.next_page_number %}">&raquo;</a>
        </li>
        <li class="page-item">
          <a class="page-link" href="?{%  url_replace request 'page' page_obj.paginator.num_pages %}">Last</a>
        </li>
      {% else %}
        <li class="page-item disabled">
          <a class="page-link">&raquo;</a>
        </li>
        <li class="page-item disabled">
          <a class="page-link">Last</a>
        </li>
      {% endif %}
    </ul>
  </nav>
</div>

{% endblock %}